<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="592px" preserveAspectRatio="none" style="width:1112px;height:592px;background:#FFFFFF;" version="1.1" viewBox="0 0 1112 592" width="1112px" zoomAndPan="magnify"><defs><filter height="300%" id="f12nfbyhsc4y4t" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><!--MD5=[f977f4f25e731d82c647a39dabc5b9bd]
cluster stage--><polygon fill="#FFFFFF" filter="url(#f12nfbyhsc4y4t)" points="16,6,61,6,68,28.4883,1095,28.4883,1095,585,16,585,16,6" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="16" x2="68" y1="28.4883" y2="28.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="39" x="20" y="21.5352">stage</text><!--MD5=[afd407483e32cc5204bf9addaa3326f9]
class stage.MetaStage--><rect codeLine="2" fill="#FEFECE" filter="url(#f12nfbyhsc4y4t)" height="60.9551" id="stage.MetaStage" style="stroke:#A80036;stroke-width:1.5;" width="161" x="717.5" y="54"/><ellipse cx="764.25" cy="70" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M760.6777,66.2651 L760.6777,64.1069 L768.0571,64.1069 L768.0571,66.2651 L765.5918,66.2651 L765.5918,74.3418 L768.0571,74.3418 L768.0571,76.5 L760.6777,76.5 L760.6777,74.3418 L763.1431,74.3418 L763.1431,66.2651 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="59" x="784.75" y="74.5352">MetaStage</text><line style="stroke:#A80036;stroke-width:1.5;" x1="718.5" x2="877.5" y1="86" y2="86"/><line style="stroke:#A80036;stroke-width:1.5;" x1="718.5" x2="877.5" y1="94" y2="94"/><ellipse cx="728.5" cy="105" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="135" x="737.5" y="108.6348">With( ...Middleware) Stage</text><!--MD5=[8d2df6c421da5ec1f75b50639d5ae277]
class stage.RankFuncStage--><rect codeLine="6" fill="#FEFECE" filter="url(#f12nfbyhsc4y4t)" height="86.8652" id="stage.RankFuncStage" style="stroke:#A80036;stroke-width:1.5;" width="487" x="114.5" y="41"/><ellipse cx="310.75" cy="57" fill="#7FFFD4" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M310.4834,58.063 Q308.6323,57.3574 307.9766,56.5813 Q307.3208,55.8052 307.3208,54.4937 Q307.3208,52.8086 308.3999,51.8457 Q309.479,50.8828 311.3633,50.8828 Q312.2183,50.8828 313.0732,51.0779 Q313.9282,51.2729 314.7666,51.6548 L314.7666,54.0454 Q313.978,53.4893 313.1646,53.1987 Q312.3511,52.9082 311.5542,52.9082 Q310.666,52.9082 310.1929,53.2651 Q309.7197,53.6221 309.7197,54.2861 Q309.7197,54.8008 310.0642,55.137 Q310.4087,55.4731 311.5044,55.8799 L312.5586,56.2783 Q314.0527,56.8262 314.7583,57.731 Q315.4639,58.6357 315.4639,60.0137 Q315.4639,61.8896 314.3557,62.8152 Q313.2476,63.7407 311.0063,63.7407 Q310.085,63.7407 309.1594,63.5208 Q308.2339,63.3008 307.3706,62.8691 L307.3706,60.3374 Q308.3501,61.0347 309.2673,61.375 Q310.1846,61.7153 311.0811,61.7153 Q311.9858,61.7153 312.4839,61.3044 Q312.9819,60.8936 312.9819,60.1548 Q312.9819,59.5986 312.6499,59.1794 Q312.3179,58.7603 311.687,58.5195 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="86" x="331.25" y="61.5352">RankFuncStage</text><line style="stroke:#A80036;stroke-width:1.5;" x1="115.5" x2="600.5" y1="73" y2="73"/><ellipse cx="125.5" cy="84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;fill:none;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="65" x="134.5" y="87.6348">Name string</text><line style="stroke:#A80036;stroke-width:1.5;" x1="115.5" x2="600.5" y1="93.9551" y2="93.9551"/><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="122.5" y="101.9551"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="11" x="134.5" y="108.5898">fn</text><text fill="#0000FF" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="24" x="148.5" y="108.5898">func</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="394" x="172.5" y="108.5898">(context.Context, *proto.RankingRequest) (*proto.RankingRequest, error)</text><ellipse cx="125.5" cy="117.9102" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="461" x="134.5" y="121.5449">Rank(ctx context.Context, req *proto.RankingRequest) (*proto.RankingRequest, error)</text><!--MD5=[bb3ef0807d656071e8f7b648806b3e35]
class stage.RouterStage--><rect codeLine="14" fill="#FEFECE" filter="url(#f12nfbyhsc4y4t)" height="99.8203" id="stage.RouterStage" style="stroke:#A80036;stroke-width:1.5;" width="247" x="674.5" y="469"/><ellipse cx="759.25" cy="485" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M755.6777,481.2651 L755.6777,479.1069 L763.0571,479.1069 L763.0571,481.2651 L760.5918,481.2651 L760.5918,489.3418 L763.0571,489.3418 L763.0571,491.5 L755.6777,491.5 L755.6777,489.3418 L758.1431,489.3418 L758.1431,481.2651 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="69" x="779.75" y="489.5352">RouterStage</text><line style="stroke:#A80036;stroke-width:1.5;" x1="675.5" x2="920.5" y1="501" y2="501"/><line style="stroke:#A80036;stroke-width:1.5;" x1="675.5" x2="920.5" y1="509" y2="509"/><ellipse cx="685.5" cy="520" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="88" x="694.5" y="523.6348">Routes() []string</text><ellipse cx="685.5" cy="532.9551" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="204" x="694.5" y="536.5898">AddRoute(method string, stage Stage)</text><ellipse cx="685.5" cy="545.9102" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="221" x="694.5" y="549.5449">AddPostRoute(postID string, stage Stage)</text><ellipse cx="685.5" cy="558.8652" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="215" x="694.5" y="562.5">AddShadowRoute(from string, to string)</text><!--MD5=[df827679c05e121c3c0962dcae1f401e]
class stage.Stage--><rect codeLine="21" fill="#FEFECE" filter="url(#f12nfbyhsc4y4t)" height="48" id="stage.Stage" style="stroke:#A80036;stroke-width:1.5;" width="63" x="766.5" y="361"/><ellipse cx="781.5" cy="377" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M777.9277,373.2651 L777.9277,371.1069 L785.3071,371.1069 L785.3071,373.2651 L782.8418,373.2651 L782.8418,381.3418 L785.3071,381.3418 L785.3071,383.5 L777.9277,383.5 L777.9277,381.3418 L780.3931,381.3418 L780.3931,373.2651 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="31" x="795.5" y="381.5352">Stage</text><line style="stroke:#A80036;stroke-width:1.5;" x1="767.5" x2="828.5" y1="393" y2="393"/><line style="stroke:#A80036;stroke-width:1.5;" x1="767.5" x2="828.5" y1="401" y2="401"/><!--MD5=[fde2e9b976f07de60b51c1eca2ea20ef]
class stage.pipeline--><rect codeLine="23" fill="#FEFECE" filter="url(#f12nfbyhsc4y4t)" height="99.8203" id="stage.pipeline" style="stroke:#A80036;stroke-width:1.5;" width="487" x="32.5" y="194.5"/><ellipse cx="248.75" cy="210.5" fill="#7FFFD4" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M248.4834,211.563 Q246.6323,210.8574 245.9766,210.0813 Q245.3208,209.3052 245.3208,207.9937 Q245.3208,206.3086 246.3999,205.3457 Q247.479,204.3828 249.3633,204.3828 Q250.2183,204.3828 251.0732,204.5779 Q251.9282,204.7729 252.7666,205.1548 L252.7666,207.5454 Q251.978,206.9893 251.1646,206.6987 Q250.3511,206.4082 249.5542,206.4082 Q248.666,206.4082 248.1929,206.7651 Q247.7197,207.1221 247.7197,207.7861 Q247.7197,208.3008 248.0642,208.637 Q248.4087,208.9731 249.5044,209.3799 L250.5586,209.7783 Q252.0527,210.3262 252.7583,211.231 Q253.4639,212.1357 253.4639,213.5137 Q253.4639,215.3896 252.3557,216.3152 Q251.2476,217.2407 249.0063,217.2407 Q248.085,217.2407 247.1594,217.0208 Q246.2339,216.8008 245.3706,216.3691 L245.3706,213.8374 Q246.3501,214.5347 247.2673,214.875 Q248.1846,215.2153 249.0811,215.2153 Q249.9858,215.2153 250.4839,214.8044 Q250.9819,214.3936 250.9819,213.6548 Q250.9819,213.0986 250.6499,212.6794 Q250.3179,212.2603 249.687,212.0195 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="46" x="269.25" y="215.0352">pipeline</text><line style="stroke:#A80036;stroke-width:1.5;" x1="33.5" x2="518.5" y1="226.5" y2="226.5"/><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="40.5" y="234.5"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="64" x="52.5" y="241.1348">name string</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="40.5" y="247.4551"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="61" x="52.5" y="254.0898">stage Stage</text><line style="stroke:#A80036;stroke-width:1.5;" x1="33.5" x2="518.5" y1="260.4102" y2="260.4102"/><ellipse cx="43.5" cy="271.4102" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="461" x="52.5" y="275.0449">Rank(ctx context.Context, req *proto.RankingRequest) (*proto.RankingRequest, error)</text><ellipse cx="43.5" cy="284.3652" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="202" x="52.5" y="288">With(middlewares ...Middleware) Stage</text><!--MD5=[13b079101ed3e3c1d899d2000778658b]
class stage.series--><rect codeLine="31" fill="#FEFECE" filter="url(#f12nfbyhsc4y4t)" height="112.7754" id="stage.series" style="stroke:#A80036;stroke-width:1.5;" width="487" x="554.5" y="188"/><ellipse cx="776.75" cy="204" fill="#7FFFD4" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M776.4834,205.063 Q774.6323,204.3574 773.9766,203.5813 Q773.3208,202.8052 773.3208,201.4937 Q773.3208,199.8086 774.3999,198.8457 Q775.479,197.8828 777.3633,197.8828 Q778.2183,197.8828 779.0732,198.0779 Q779.9282,198.2729 780.7666,198.6548 L780.7666,201.0454 Q779.978,200.4893 779.1646,200.1987 Q778.3511,199.9082 777.5542,199.9082 Q776.666,199.9082 776.1929,200.2651 Q775.7197,200.6221 775.7197,201.2861 Q775.7197,201.8008 776.0642,202.137 Q776.4087,202.4731 777.5044,202.8799 L778.5586,203.2783 Q780.0527,203.8262 780.7583,204.731 Q781.4639,205.6357 781.4639,207.0137 Q781.4639,208.8896 780.3557,209.8152 Q779.2476,210.7407 777.0063,210.7407 Q776.085,210.7407 775.1594,210.5208 Q774.2339,210.3008 773.3706,209.8691 L773.3706,207.3374 Q774.3501,208.0347 775.2673,208.375 Q776.1846,208.7153 777.0811,208.7153 Q777.9858,208.7153 778.4839,208.3044 Q778.9819,207.8936 778.9819,207.1548 Q778.9819,206.5986 778.6499,206.1794 Q778.3179,205.7603 777.687,205.5195 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="34" x="797.25" y="208.5352">series</text><line style="stroke:#A80036;stroke-width:1.5;" x1="555.5" x2="1040.5" y1="220" y2="220"/><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="562.5" y="228"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="75" x="574.5" y="234.6348">stages []Stage</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="562.5" y="240.9551"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="71" x="574.5" y="247.5898">optional bool</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="562.5" y="253.9102"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="82" x="574.5" y="260.5449">errorKey string</text><line style="stroke:#A80036;stroke-width:1.5;" x1="555.5" x2="1040.5" y1="266.8652" y2="266.8652"/><ellipse cx="565.5" cy="277.8652" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="461" x="574.5" y="281.5">Rank(ctx context.Context, req *proto.RankingRequest) (*proto.RankingRequest, error)</text><ellipse cx="565.5" cy="290.8203" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="202" x="574.5" y="294.4551">With(middlewares ...Middleware) Stage</text><!--MD5=[021a1e7e560ec5d885e2abe76719c465]
reverse link stage.Stage to stage.MetaStage--><path codeLine="41" d="M843.98,384.54 C904.67,382.46 1009.58,368.58 1059,301 C1088.65,260.46 1087.29,229.5 1059,188 C1018.97,129.27 939.71,104.19 878.98,93.48 " fill="none" id="stage.Stage-backto-stage.MetaStage" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="831.08,384.81,837.1622,388.6839,843.0774,384.5595,836.9952,380.6856,831.08,384.81" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="50" x="886.4317" y="91.1649">extends</text><!--MD5=[2a15d97a598226ea66a818a2211ef4a4]
reverse link stage.Stage to stage.RouterStage--><path codeLine="42" d="M798,423.54 C798,437.58 798,453.75 798,468.7 " fill="none" id="stage.Stage-backto-stage.RouterStage" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="798,410.81,794,416.81,798,422.81,802,416.81,798,410.81" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="50" x="744.4844" y="458.1747">extends</text><!--MD5=[601251411cb756c122060ed8e1292170]
reverse link stage.MetaStage to stage.pipeline--><path codeLine="44" d="M696.7,116.16 C623.69,138.26 523.61,168.55 439.37,194.05 " fill="none" id="stage.MetaStage-backto-stage.pipeline" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="none" points="694.39,109.55,715.56,110.45,698.45,122.95,694.39,109.55" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74" x="382.351" y="183.8643">implements</text><!--MD5=[7fb6b8004305b55305bbe935d3d9645f]
reverse link stage.MetaStage to stage.series--><path codeLine="45" d="M798,136.7 C798,152.99 798,171.09 798,187.69 " fill="none" id="stage.MetaStage-backto-stage.series" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="none" points="791,136.73,798,116.73,805,136.73,791,136.73" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74" x="719.4906" y="177.4532">implements</text><!--MD5=[49db98e16997876eb86b8976eb2b8580]
reverse link stage.pipeline to stage.Stage--><path codeLine="47" d="M476.14,298.6 C585.11,327.51 709.07,360.41 766.15,375.55 " fill="none" id="stage.pipeline-backto-stage.Stage" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#FFFFFF" points="463.71,295.3,468.4806,300.7075,475.307,298.3837,470.5364,292.9762,463.71,295.3" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="29" x="455.2442" y="314.9408">uses</text><!--MD5=[e97c917f76c733dedc6ed7b625999e08]
reverse link stage.series to stage.Stage--><path codeLine="48" d="M798,315.68 C798,331.98 798,348.2 798,360.75 " fill="none" id="stage.series-backto-stage.Stage" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#FFFFFF" points="798,302.95,794,308.95,798,314.95,802,308.95,798,302.95" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="29" x="767.3234" y="321.479">uses</text><!--MD5=[475899433a9bb7860be4ef2f554ba50c]
@startuml
namespace stage {
    interface MetaStage  {
        + With( ...Middleware) Stage

    }
    class RankFuncStage << (S,Aquamarine) >> {
        - fn <font color=blue>func</font>(context.Context, *proto.RankingRequest) (*proto.RankingRequest, error)

        + Name string

        + Rank(ctx context.Context, req *proto.RankingRequest) (*proto.RankingRequest, error)

    }
    interface RouterStage  {
        + Routes() []string
        + AddRoute(method string, stage Stage) 
        + AddPostRoute(postID string, stage Stage) 
        + AddShadowRoute(from string, to string) 

    }
    interface Stage  {
    }
    class pipeline << (S,Aquamarine) >> {
        - name string
        - stage Stage

        + Rank(ctx context.Context, req *proto.RankingRequest) (*proto.RankingRequest, error)
        + With(middlewares ...Middleware) Stage

    }
    class series << (S,Aquamarine) >> {
        - stages []Stage
        - optional bool
        - errorKey string

        + Rank(ctx context.Context, req *proto.RankingRequest) (*proto.RankingRequest, error)
        + With(middlewares ...Middleware) Stage

    }
}
"stage.Stage" *- - "extends""stage.MetaStage"
"stage.Stage" *- - "extends""stage.RouterStage"

"stage.MetaStage" <|- - "implements""stage.pipeline"
"stage.MetaStage" <|- - "implements""stage.series"

"stage.pipeline""uses" o- - "stage.Stage"
"stage.series""uses" o- - "stage.Stage"

@enduml

PlantUML version 1.2021.11(Sat Oct 02 06:26:11 PDT 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>