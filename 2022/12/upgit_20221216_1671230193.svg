<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="592px" preserveAspectRatio="none" style="width:749px;height:592px;background:#FFFFFF;" version="1.1" viewBox="0 0 749 592" width="749px" zoomAndPan="magnify"><defs><filter height="300%" id="f1qxk4votk64v4" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><!--MD5=[f977f4f25e731d82c647a39dabc5b9bd]
cluster stage--><polygon fill="#FFFFFF" filter="url(#f1qxk4votk64v4)" points="16,6,61,6,68,28.4883,732,28.4883,732,585,16,585,16,6" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="16" x2="68" y1="28.4883" y2="28.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="39" x="20" y="21.5352">stage</text><!--MD5=[afd407483e32cc5204bf9addaa3326f9]
class stage.MetaStage--><rect codeLine="2" fill="#FEFECE" filter="url(#f1qxk4votk64v4)" height="60.9551" id="stage.MetaStage" style="stroke:#A80036;stroke-width:1.5;" width="161" x="554.5" y="54"/><ellipse cx="601.25" cy="70" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M597.6777,66.2651 L597.6777,64.1069 L605.0571,64.1069 L605.0571,66.2651 L602.5918,66.2651 L602.5918,74.3418 L605.0571,74.3418 L605.0571,76.5 L597.6777,76.5 L597.6777,74.3418 L600.1431,74.3418 L600.1431,66.2651 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="59" x="621.75" y="74.5352">MetaStage</text><line style="stroke:#A80036;stroke-width:1.5;" x1="555.5" x2="714.5" y1="86" y2="86"/><line style="stroke:#A80036;stroke-width:1.5;" x1="555.5" x2="714.5" y1="94" y2="94"/><ellipse cx="565.5" cy="105" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="135" x="574.5" y="108.6348">With( ...Middleware) Stage</text><!--MD5=[8d2df6c421da5ec1f75b50639d5ae277]
class stage.RankFuncStage--><rect codeLine="6" fill="#FEFECE" filter="url(#f1qxk4votk64v4)" height="86.8652" id="stage.RankFuncStage" style="stroke:#A80036;stroke-width:1.5;" width="487" x="32.5" y="41"/><ellipse cx="228.75" cy="57" fill="#7FFFD4" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M228.4834,58.063 Q226.6323,57.3574 225.9766,56.5813 Q225.3208,55.8052 225.3208,54.4937 Q225.3208,52.8086 226.3999,51.8457 Q227.479,50.8828 229.3633,50.8828 Q230.2183,50.8828 231.0732,51.0779 Q231.9282,51.2729 232.7666,51.6548 L232.7666,54.0454 Q231.978,53.4893 231.1646,53.1987 Q230.3511,52.9082 229.5542,52.9082 Q228.666,52.9082 228.1929,53.2651 Q227.7197,53.6221 227.7197,54.2861 Q227.7197,54.8008 228.0642,55.137 Q228.4087,55.4731 229.5044,55.8799 L230.5586,56.2783 Q232.0527,56.8262 232.7583,57.731 Q233.4639,58.6357 233.4639,60.0137 Q233.4639,61.8896 232.3557,62.8152 Q231.2476,63.7407 229.0063,63.7407 Q228.085,63.7407 227.1594,63.5208 Q226.2339,63.3008 225.3706,62.8691 L225.3706,60.3374 Q226.3501,61.0347 227.2673,61.375 Q228.1846,61.7153 229.0811,61.7153 Q229.9858,61.7153 230.4839,61.3044 Q230.9819,60.8936 230.9819,60.1548 Q230.9819,59.5986 230.6499,59.1794 Q230.3179,58.7603 229.687,58.5195 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="86" x="249.25" y="61.5352">RankFuncStage</text><line style="stroke:#A80036;stroke-width:1.5;" x1="33.5" x2="518.5" y1="73" y2="73"/><ellipse cx="43.5" cy="84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;fill:none;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="65" x="52.5" y="87.6348">Name string</text><line style="stroke:#A80036;stroke-width:1.5;" x1="33.5" x2="518.5" y1="93.9551" y2="93.9551"/><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="40.5" y="101.9551"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="11" x="52.5" y="108.5898">fn</text><text fill="#0000FF" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="24" x="66.5" y="108.5898">func</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="394" x="90.5" y="108.5898">(context.Context, *proto.RankingRequest) (*proto.RankingRequest, error)</text><ellipse cx="43.5" cy="117.9102" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="461" x="52.5" y="121.5449">Rank(ctx context.Context, req *proto.RankingRequest) (*proto.RankingRequest, error)</text><!--MD5=[bb3ef0807d656071e8f7b648806b3e35]
class stage.RouterStage--><rect codeLine="14" fill="#FEFECE" filter="url(#f1qxk4votk64v4)" height="99.8203" id="stage.RouterStage" style="stroke:#A80036;stroke-width:1.5;" width="247" x="389.5" y="469"/><ellipse cx="474.25" cy="485" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M470.6777,481.2651 L470.6777,479.1069 L478.0571,479.1069 L478.0571,481.2651 L475.5918,481.2651 L475.5918,489.3418 L478.0571,489.3418 L478.0571,491.5 L470.6777,491.5 L470.6777,489.3418 L473.1431,489.3418 L473.1431,481.2651 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="69" x="494.75" y="489.5352">RouterStage</text><line style="stroke:#A80036;stroke-width:1.5;" x1="390.5" x2="635.5" y1="501" y2="501"/><line style="stroke:#A80036;stroke-width:1.5;" x1="390.5" x2="635.5" y1="509" y2="509"/><ellipse cx="400.5" cy="520" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="88" x="409.5" y="523.6348">Routes() []string</text><ellipse cx="400.5" cy="532.9551" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="204" x="409.5" y="536.5898">AddRoute(method string, stage Stage)</text><ellipse cx="400.5" cy="545.9102" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="221" x="409.5" y="549.5449">AddPostRoute(postID string, stage Stage)</text><ellipse cx="400.5" cy="558.8652" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="215" x="409.5" y="562.5">AddShadowRoute(from string, to string)</text><!--MD5=[df827679c05e121c3c0962dcae1f401e]
class stage.Stage--><rect codeLine="21" fill="#FEFECE" filter="url(#f1qxk4votk64v4)" height="48" id="stage.Stage" style="stroke:#A80036;stroke-width:1.5;" width="63" x="481.5" y="361"/><ellipse cx="496.5" cy="377" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M492.9277,373.2651 L492.9277,371.1069 L500.3071,371.1069 L500.3071,373.2651 L497.8418,373.2651 L497.8418,381.3418 L500.3071,381.3418 L500.3071,383.5 L492.9277,383.5 L492.9277,381.3418 L495.3931,381.3418 L495.3931,373.2651 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="31" x="510.5" y="381.5352">Stage</text><line style="stroke:#A80036;stroke-width:1.5;" x1="482.5" x2="543.5" y1="393" y2="393"/><line style="stroke:#A80036;stroke-width:1.5;" x1="482.5" x2="543.5" y1="401" y2="401"/><!--MD5=[13b079101ed3e3c1d899d2000778658b]
class stage.series--><rect codeLine="23" fill="#FEFECE" filter="url(#f1qxk4votk64v4)" height="112.7754" id="stage.series" style="stroke:#A80036;stroke-width:1.5;" width="487" x="151.5" y="188"/><ellipse cx="373.75" cy="204" fill="#7FFFD4" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M373.4834,205.063 Q371.6323,204.3574 370.9766,203.5813 Q370.3208,202.8052 370.3208,201.4937 Q370.3208,199.8086 371.3999,198.8457 Q372.479,197.8828 374.3633,197.8828 Q375.2183,197.8828 376.0732,198.0779 Q376.9282,198.2729 377.7666,198.6548 L377.7666,201.0454 Q376.978,200.4893 376.1646,200.1987 Q375.3511,199.9082 374.5542,199.9082 Q373.666,199.9082 373.1929,200.2651 Q372.7197,200.6221 372.7197,201.2861 Q372.7197,201.8008 373.0642,202.137 Q373.4087,202.4731 374.5044,202.8799 L375.5586,203.2783 Q377.0527,203.8262 377.7583,204.731 Q378.4639,205.6357 378.4639,207.0137 Q378.4639,208.8896 377.3557,209.8152 Q376.2476,210.7407 374.0063,210.7407 Q373.085,210.7407 372.1594,210.5208 Q371.2339,210.3008 370.3706,209.8691 L370.3706,207.3374 Q371.3501,208.0347 372.2673,208.375 Q373.1846,208.7153 374.0811,208.7153 Q374.9858,208.7153 375.4839,208.3044 Q375.9819,207.8936 375.9819,207.1548 Q375.9819,206.5986 375.6499,206.1794 Q375.3179,205.7603 374.687,205.5195 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="34" x="394.25" y="208.5352">series</text><line style="stroke:#A80036;stroke-width:1.5;" x1="152.5" x2="637.5" y1="220" y2="220"/><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="159.5" y="228"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="75" x="171.5" y="234.6348">stages []Stage</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="159.5" y="240.9551"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="71" x="171.5" y="247.5898">optional bool</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="159.5" y="253.9102"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="82" x="171.5" y="260.5449">errorKey string</text><line style="stroke:#A80036;stroke-width:1.5;" x1="152.5" x2="637.5" y1="266.8652" y2="266.8652"/><ellipse cx="162.5" cy="277.8652" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="461" x="171.5" y="281.5">Rank(ctx context.Context, req *proto.RankingRequest) (*proto.RankingRequest, error)</text><ellipse cx="162.5" cy="290.8203" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="202" x="171.5" y="294.4551">With(middlewares ...Middleware) Stage</text><!--MD5=[021a1e7e560ec5d885e2abe76719c465]
reverse link stage.Stage to stage.MetaStage--><path codeLine="33" d="M558.45,371.13 C591.96,358.98 635.19,337.13 656,301 C689.86,242.2 665.53,159.18 648.24,115.33 " fill="none" id="stage.Stage-backto-stage.MetaStage" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="546.21,375.26,553.1762,377.1235,557.5756,371.4099,550.6094,369.5464,546.21,375.26" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="50" x="595.9248" y="135.4796">extends</text><!--MD5=[2a15d97a598226ea66a818a2211ef4a4]
reverse link stage.Stage to stage.RouterStage--><path codeLine="34" d="M513,423.54 C513,437.58 513,453.75 513,468.7 " fill="none" id="stage.Stage-backto-stage.RouterStage" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="513,410.81,509,416.81,513,422.81,517,416.81,513,410.81" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="50" x="459.4844" y="458.1747">extends</text><!--MD5=[7fb6b8004305b55305bbe935d3d9645f]
reverse link stage.MetaStage to stage.series--><path codeLine="36" d="M571.9,127.04 C543.67,145.63 509.96,167.82 479.59,187.81 " fill="none" id="stage.MetaStage-backto-stage.series" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="none" points="567.76,121.39,588.31,116.24,575.46,133.08,567.76,121.39" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74" x="411.6875" y="177.1883">implements</text><!--MD5=[e97c917f76c733dedc6ed7b625999e08]
reverse link stage.series to stage.Stage--><path codeLine="38" d="M451.85,312.23 C466.71,329.66 481.75,347.32 493.19,360.75 " fill="none" id="stage.series-backto-stage.Stage" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#FFFFFF" points="443.64,302.59,444.4838,309.7516,451.4191,311.7271,450.5752,304.5655,443.64,302.59" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="29" x="417.483" y="321.479">uses</text><!--MD5=[efdf788d908516add815f4d2d0379c97]
@startuml
namespace stage {
    interface MetaStage  {
        + With( ...Middleware) Stage

    }
    class RankFuncStage << (S,Aquamarine) >> {
        - fn <font color=blue>func</font>(context.Context, *proto.RankingRequest) (*proto.RankingRequest, error)

        + Name string

        + Rank(ctx context.Context, req *proto.RankingRequest) (*proto.RankingRequest, error)

    }
    interface RouterStage  {
        + Routes() []string
        + AddRoute(method string, stage Stage) 
        + AddPostRoute(postID string, stage Stage) 
        + AddShadowRoute(from string, to string) 

    }
    interface Stage  {
    }
    class series << (S,Aquamarine) >> {
        - stages []Stage
        - optional bool
        - errorKey string

        + Rank(ctx context.Context, req *proto.RankingRequest) (*proto.RankingRequest, error)
        + With(middlewares ...Middleware) Stage

    }
}
"stage.Stage" *- - "extends""stage.MetaStage"
"stage.Stage" *- - "extends""stage.RouterStage"

"stage.MetaStage" <|- - "implements""stage.series"

"stage.series""uses" o- - "stage.Stage"

@enduml

PlantUML version 1.2021.11(Sat Oct 02 06:26:11 PDT 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>